<!DOCTYPE html>
<html ng-app="module" ng-controller="controller" lang="en">
<head>
    <title>Music Transfer</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="res/icon.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="src/style.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.3/angular-sanitize.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script type="module" src="src/controller.js"></script>
</head>
<body class="d-flex flex-column align-items-center m-4">

<header class="text-center">
    <h1 class="fs-1 fw-bold">
        Music Transfer
    </h1>
    <h2 class="fs-5 fw-light text-decoration-underline">
        Transfer your favourite artists, albums, tracks, and playlists across streaming platforms!
    </h2>
</header>

<main class="w-100 d-flex flex-column gap-4 my-4" style="max-width: 1200px">
    <div class="d-flex flex-column flex-md-row gap-1 gap-md-3 align-items-md-center">
        <label for="source" class="text-nowrap">
            <span class="fw-bolder">1.</span> Select your <span class="text-emphasize">source</span> service:
        </label>
        <select id="source"
                class="w-100 small"
                style="padding: 2px 6px"
                ng-model="choices.source"
                ng-init="update()"
                ng-change="update()"
                ng-options="service as service.sourceTitle disable when service.name === 'dummy' for service in services">
        </select>
    </div>

    <div class="d-flex flex-column flex-md-row gap-1 gap-md-3 align-items-md-center" ng-if="choices.source.token">
        <label for="target" class="text-nowrap">
            <span class="fw-bolder">2.</span> Select your <span class="text-emphasize">target</span> service:
        </label>
        <select id="target"
                class="w-100 small"
                style="padding: 2px 6px"
                ng-model="choices.target"
                ng-init="update()"
                ng-change="update()"
                ng-options="service as service.targetTitle disable when service.name === 'dummy' for service in services">
        </select>
    </div>

    <div class="d-flex flex-column gap-2" ng-if="choices.source.token && choices.target.token">
        <label for="group">
            <span class="fw-bolder">3.</span> Select the <span class="text-emphasize">group</span> you want to transfer:
        </label>
        <select id="group"
                class="w-100 small"
                style="padding: 2px 6px"
                ng-model="choices.group"
                ng-change="choices.group.selected = true"
                ng-options="group as group.name for group in choices.source.groups">
        </select>
        <div class="row buttons">
            <button type="button"
                    class="col text-decoration-underline ms-3"
                    ng-disabled="!choices.group.ready"
                    ng-click="selection(true)">
                All ({{choices.group.items.length}})
            </button>
            <button type="button"
                    class="col text-decoration-underline mx-2"
                    ng-disabled="!choices.group.ready"
                    ng-click="selection(false)">
                None
            </button>
            <button type="button"
                    data-bs-toggle="modal"
                    data-bs-target="#modal"
                    class="col text-decoration-underline text-capitalize me-3"
                    ng-disabled="!choices.group.ready"
                    ng-click="transfer()">
                {{choices.group.ready ? "Transfer" : choices.group.items.length + " items..."}}
            </button>
        </div>
        <div class="d-grid small items">
            <div ng-repeat="item in choices.group.items"
                 class="d-flex flex-xl-row align-items-center gap-2 mx-3 my-1"
                 ng-class="{'flex-md-row-reverse': $odd}">
                <input type="checkbox" id="{{key}}-{{item.id}}" ng-model="item.selected"/>
                <label for="{{key}}-{{item.id}}"
                       class="text-xl-start {{item.selected ? 'fw-bold' : 'text-decoration-line-through'}}"
                       ng-class="{'text-md-end': $odd}">
                    {{item.name}}
                </label>
            </div>
        </div>
    </div>

    <div id="modal"
         class="modal fade"
         data-bs-backdrop="static"
         data-bs-keyboard="false"
         aria-labelledby="label"
         aria-hidden="true"
         tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title h5" id="label">
                        {{choices.source.name.toUpperCase()}} {{choices.animation}} {{choices.target.name.toUpperCase()}}
                    </div>
                </div>
                <div class="modal-body">
                    <div class="row my-2" ng-repeat="transfer in choices.target.transfers">
                        <span class="col-6 fw-bold">{{transfer.name}}</span>
                        <span class="col-6 d-flex justify-content-end fst-italic">
                            {{transfer.status}}
                            <a class="ms-1 text-decoration-none"
                               data-bs-toggle="collapse"
                               href="#missing-{{$index}}"
                               role="button"
                               aria-expanded="false"
                               aria-controls="missing-{{$index}}"
                            >+</a>
                        </span>
                        <div class="collapse" id="missing-{{$index}}">
                            <div class="card card-body">
                                <span class="h6">Missing Items</span>
                                <ul>
                                    <li ng-repeat="missing in transfer.missing">{{missing.name}}</li>
                                </ul>
                                <span ng-if="transfer.missing.length === 0">
                                    There is currently no missing item!
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <!-- On closing the modal window, reset the target by calling deselect and then select it again -->
                    <button type="button"
                            data-bs-dismiss="modal"
                            ng-disabled="!choices.target.finished"
                            ng-click="choices.target.deselect(); choices.target.select()">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div ng-if="error" class="alert alert-danger" role="alert">{{error}}, please try again...</div>
</main>

</body>
</html>